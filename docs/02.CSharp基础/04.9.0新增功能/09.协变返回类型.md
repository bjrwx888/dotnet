---
title: 协变返回类型
date: 2023-04-17 23:01:37
permalink: /pages/269fd6/
---

在C# 9.0中，协变返回类型（Covariant returns）是一个新特性，它允许重写方法时，返回类型可以是派生类，而不仅仅是基类。这使得代码更加简洁和易于维护。在本文中，我们将深入了解协变返回类型的概念以及如何在C# 9.0中使用它。
## 概念解释

在C#中，类和接口可以被继承和实现。当我们继承一个类或者实现一个接口时，我们可以重写其方法。在重写方法时，我们必须确保方法的签名与基类或接口的签名相同，其中返回类型必须是相同的或是基类类型。

考虑下面这个例子：

```csharp

class Animal
{
    public virtual Animal GetObject()
    {
        return new Animal();
    }
}

class Cat : Animal
{
    public override Animal GetObject()
    {
        return new Cat();
    }
}
```



在这个例子中，我们定义了一个Animal类和一个继承自Animal的Cat类。Animal类有一个GetObject()方法，它返回一个Animal对象。Cat类重写了该方法，并返回一个Cat对象。

在C# 9.0之前，这种方法的重写方式是不允许的，因为返回类型必须是相同的或是基类类型。但是，在C# 9.0中，我们可以使用协变返回类型来解决这个问题。
## 协变返回类型的使用

协变返回类型使得方法的返回类型可以是派生类，而不仅仅是基类。这使得代码更加简洁和易于维护。在C# 9.0中，我们可以在方法的返回类型前面添加关键字"covariant"来指示该方法的返回类型是协变的。现在，我们来看看上面的例子如何使用协变返回类型：

```csharp

class Animal
{
    public virtual Animal GetObject()
    {
        return new Animal();
    }
}

class Cat : Animal
{
    public override Cat GetObject()
    {
        return new Cat();
    }
}
```



在这个例子中，我们使用协变返回类型来重写了GetObject()方法。在Cat类中，我们将返回类型从Animal改为了Cat，这是由于Cat是Animal的派生类，因此它满足了方法返回类型必须是派生类的要求。现在，我们可以将Cat类的对象分配给Animal类型的变量，而不需要进行显式的类型转换。

```csharp

Cat cat = new Cat();
Animal animal = cat;
```



在这个例子中，我们创建了一个Cat对象，并将其赋值给一个Animal类型的变量。由于Cat是Animal的派生类，因此我们可以将Cat对象分配给Animal类型的变量，而不需要进行显式的类型转换。
## 总结

在C# 9.0中，协变返回类型是一个非常有用的功能，它使得代码更加简洁和易于维护。在重写方法时，我们可以使用协变返回类型来指示返回类型可以是派生类，而不仅仅是基类类型。这样可以使得代码更加灵活，并且可以避免使用显式类型转换。

需要注意的是，协变返回类型只能在重写方法时使用，不能在普通方法中使用。此外，协变返回类型只能用于接口和虚方法，不能用于密封方法或静态方法。

总之，协变返回类型是C# 9.0中的一个非常有用的特性，它可以使得代码更加灵活和易于维护。使用协变返回类型时需要注意一些限制条件，但是这些限制不会影响协变返回类型在实际编程中的应用。

---
title: 使用`$`的字符串插值
date: 2023-04-18 17:47:04
permalink: /pages/b2ef17/
---

在C# 8.0中，我们可以使用 `$` 字符来实现字符串插值，这种方式比起之前的方式更加简单、直观。本文将详细介绍 C#8.0中的字符串插值的用法及其特点。
## 基本用法

字符串插值的基本用法是在字符串前面添加 `$` 符号，然后在字符串中使用花括号 `{}` 来引用变量或表达式。插值表达式会自动计算，并将结果插入到字符串中。

下面是一个简单的例子，它演示了如何在字符串中插入变量：

```csharp

string name = "小明";
int age = 18;
string message = $"大家好，我叫{name}，今年{age}岁。";
Console.WriteLine(message);
```



输出结果为：

```

大家好，我叫小明，今年18岁。
```



在上面的例子中，我们使用了 `$"..."` 的格式来创建一个带有插值表达式的字符串。表达式 `name` 和 `age` 分别引用了字符串变量 `name` 和整数变量 `age` 的值。在输出时，插值表达式会自动计算，然后将结果插入到字符串中。
## 引用属性和方法

在字符串插值中，我们还可以引用类的属性和方法。下面的例子演示了如何在字符串中引用类的属性和方法：

```csharp

class Person
{
    public string Name { get; set; }
    public int Age { get; set; }

    public string GetIntroduction() => $"大家好，我叫{Name}，今年{Age}岁。";
}

Person person = new Person { Name = "小红", Age = 20 };
string message = $"我的名字是{person.Name}，我今年{person.Age}岁，{person.GetIntroduction()}";
Console.WriteLine(message);
```



输出结果为：

```

我的名字是小红，我今年20岁，大家好，我叫小红，今年20岁。
```



在上面的例子中，我们定义了一个 `Person` 类，它有两个属性 `Name` 和 `Age`，还有一个返回自我介绍的方法 `GetIntroduction`。我们创建了一个 `Person` 对象 `person`，并在字符串中引用了它的属性和方法。
## 格式化插值表达式

除了引用变量和表达式外，我们还可以在插值表达式中使用格式化字符串。格式化字符串使用冒号 `:` 后面跟着格式规范来定义。下面是一个简单的例子：

```csharp

int value = 42;
string message = $"这是一个数字：{value:D4}";
Console.WriteLine(message);
```



输出结果为：

```

这是一个数字：0042
```



在上面的例子中，我们使用了 `D4` 格式规范来将数字格式化为4位数字，不足4位的数字会在前面填充0。
## 表达式内部使用逗号

在插值表达式中，我们还可以使用逗号来分隔表达式的多个部分，例如：

```csharp

string name = "小明";
int age = 18;
string message = $"我是{name}，今年{age}岁。";
Console.WriteLine($"消息：{message.ToUpper()}, 时间：{DateTime.Now}");
```



输出结果为：

```

消息：我是小明，今年18岁。, 时间：2023/4/18 14:37:50
```



在上面的例子中，我们使用了逗号来将多个表达式连接起来。在输出时，每个表达式都会独立计算，并插入到字符串中。
## 在插值表达式中嵌套表达式

在插值表达式中，我们还可以嵌套其他表达式，例如：

```csharp

int value1 = 42;
int value2 = 84;
Console.WriteLine($"总和：{value1 + value2}, 平均数：{(value1 + value2) / 2}");
```



输出结果为：

```

总和：126, 平均数：63
```



在上面的例子中，我们在插值表达式中嵌套了两个表达式，分别计算了两个数的总和和平均数。嵌套表达式使用了圆括号来标识。
## 需要转义的字符

在插值表达式中，有一些特殊字符需要进行转义，例如双引号 `"`、花括号 `{}` 等。下面是一个例子：

```csharp

string name = "小明";
Console.WriteLine($"我的名字是{name}, 我有一个称呼是\"大白\"{{Cool}}。");
```



输出结果为：

```arduino

我的名字是小明, 我有一个称呼是"大白"{Cool}。
```



在上面的例子中，我们需要使用反斜杠 `\` 来转义双引号 `"` 和花括号 `{}`。
## 总结

在 C# 8.0 中，我们可以使用 `$` 符号来实现字符串插值，它比起之前的方式更加简单、直观。我们可以在插值表达式中引用变量、属性、方法和表达式，还可以使用格式化字符串、逗号和嵌套表达式来定制字符串的输出。但是，我们需要注意特殊字符的转义，以免产生错误。
